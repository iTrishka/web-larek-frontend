# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```


Описание проекта
----------------

Приложение представляет собой интернет-магазин с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

Проект содержит в себе 2 layout(экрана) в котором и происходит работа нашего приложения и его функциональных блоков:

1.  **Блок главной страницы(Page)** Содержит заголовок и галерею товаров, которая в свою очередь состоит из отдельных элементов - карточек товаров.
2.  **Блок Модальное окно(Modal)** Расположен оверлеем на главной странице. Изначально это элемент интерфейса у которого есть только кнопка закрыть.

Основные крупные функциональные блоки (отображения) из которых строится наше приложение:

1.  **Хедер** - состоит из логотипа и иконки корзины с счетчиком;
2.  **Каталог товаров** - выводит набор карточек, который мы ей передали;
3.  **Карточка товара** - содержит категорию товара, название, картинку и цену;
4.  **Карточка товара в модальном окне** - повторяет содержимое карточки товаров(c увеличенным шрифтом названия товара и картинки) + добавляется описание товара и кнопка “Купить”;
5.  **Корзина** - состоит из заголовка, списка товаров, общей суммы заказа и кнопки “Оформить”;
6.  **Элемент товара в корзине** - выводит информацию о товаре(название и стоимость) и иконку корзины, которая позволяет удалить товар из списка;
7.  **Форма доставки** - содержит 2 элемента формы(заголовок Способ оплаты с 2 вариантами на выбор и заголовок Адрес доставки с полем input type="text" ) и кнопкой “Далее”;
8.  **Форма контактных данных** - содержит 2 элемента формы с заголовками Email и Телефон, соответствующими полями input type="text" и кнопкой “Оформить”;
9.  **Блок успешного оформления заказа** - отрисовывает иконку и заголовок успешного оформления заказа, выводит информацию о списанной сумме, а также кнопку “За новыми покупками!”, ведущую на главную страницу приложения.

Данные, которые, мы используем для работы приложения и реализации его функционала;

*   **Каталог товаров,** который мы запрашиваем по api (GET на endpoint - /product/).
*   В свою очередь каталог товаров состоит из **карточек товаров**, которые включают в себя id, название товара, описание, ссылку на картинку, категорию и цену товара.
*   **Корзина**, которая включает в себя часть данных из карточки товаров( заголовок и цену) и общую сумму товара.
*   **Заказ**, для отправки на сервер которого мы используем данные из корзины и собранной информации из форм(POST на endpoint - /order):

1.  Способ оплаты
2.  Адрес
3.  Телефон
4.  Emaile
5.  Сумма заказа
6.  Список id товаров

Также по макету предоставлен UI кит, который содержит более мелкие функциональные блоки:

1.  Кнопка в обычном состоянии и при наведении;
2.  Иконки закрытия и удаления в обычном состоянии и при наведении;
3.  Кнопка выбора способа оплаты в активном и не активном состоянии;
4.  Дополнительно выделен инпут формы.

Архитектура
-----------

В проекте используется шаблон проектирования MVP. Так как наше приложение небольшое, представление(Presenter) будет реализован классом EventEmmiter.

[![uml scheme](./src/images/uml_scheme.jpg)](./src/images/uml_scheme.jpg)


### Описание данных
* Интерфейс состояния приложения
~~~
interface IAppState {
  catalog: {
    total: number;
    items: IProductCard[];
  };
  preview: IProductCard;
  order: IOrder;
  loading: boolean;
}
~~~

* Интрефейс карточки товара
~~~
export interface IProductCard {
  id: string;
  title: string;
  description: string;
  image: string;
  category: string;
  price: number | null;
};
~~~

* Тип карточки товара для галереи на главной страницы
~~~
export type ICatalogItem = Omit<IProductCard, 'description'>;
~~~

* Тип корзины
~~~
export type IBasket= {
  item: Pick<IProductCard, 'id' | 'title' | 'price'>[]
  total: number
};
~~~

* Тип способа оплаты
~~~
export type IPaymenOption  = 'cash' | 'card';
~~~

* Интрефейс данных заказа
~~~
export interface IOrder{
  payment: IPaymenOption;
  address: string;
  phone: string;
  email: string;
  total: number;
  items: string[];
};
~~~

Тип модального окна с формой доставки
~~~
export type IOrderDelivery = Pick<IOrder, 'payment' | 'address'>;
~~~

Тип модального окна с формой контактов
~~~
export type IOrderContacts = Pick<IOrder, 'phone' | 'email'>;
~~~

Интерфейс главной старницы
~~~
export interface IPage {
  counterBasket: number;
  catalog: ICatalogItem[];
  locked: boolean;
};
~~~

### Базовые классы

1. #### **Класс Component<T>**  
   Абстрактный базовый класс для компонентов, который содержит инструментарий для работы с DOM в дочерних компонентах.  
   __Конструктор:__:  
   Аргументом конструктора служит HTMLElement.  
      container: HTMLElement
   __Методы класса__:
   - _toggleClass_ - переключение класса;
   - _setText_ - установка текстового содержимого;
   - _show, hide_ - скрыть/показать элемент.

2. #### **Класс Model<T>**  
   Абстрактный базовый класс, чтобы можно было отличить ее от простых объектов с данными.  
   __Конструктор:__:  
   Аргументы: исходные данные, которые будут установлены в класс и события  
   data: Partial<T>, protected events: IEvents  
   __Методы класса__:  
   - _emitChanges_ - уведомляет о событиях и связанных с ними изменениями;  

### Слой Модели данных
1. #### **Класс AppState extend Model implements IAppState.** 
Класс описывает состояние приложения.  
__Методы класса__:
   - _setCatalog(IProductCard[]): void_ // метод, который записывает список товаров, пришедших с сервера в  AppState.catalog
   - _setPreview(id): void_ // метод, который записывает id карточки для отображения попапа с полной ифнормацией о товаре
   - _getTotalPrice(): void_ // метод, расчитывает общую стоимость заказа
   - _countBasketItem(): number_ //метод, расчитывает количество товарво в корзины
   - _setOrderItem(id, string)_ // метод записывает id товара в AppState.catalog.order.items
   - _setOrderField(keyof IOrder_, string |string[] ): void  // метод записывает значения полей формы в AppState.catalog.order
   - _validateOrder(): boolean _// метод  проверки валидации полей
   - _clearBasket(): void_ // метод очистки корзины

### Слой Presenter

1. #### **Класс Api**  
   Класc для работы с api.  
   __Методы класса__:
   - _handleResponse_ // обработка ответа с сервера;
   - _get_ // выполнение GET запроса;
   - _post_ // выполнение POST запроса;

2. #### **Класс EventEmitter**   
   Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.  
   __Методы класса__:

   - _on , off , emit_ // для подписки на событие, отписки от события и уведомления подписчиков о наступлении события соответственно.
   - _onAll и offAll_ // для подписки на все события и сброса всех подписчиков.
   - _trigger_ // генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter .

### Слой View - Компоненты представления

1. #### **Класс Modal extends Component**    
   Универсальный класс для работы с модальными окнами.  
   Конструктор принимает в качестве аргумента селектор интересующего нас модального окна.   
   __Методы класса__:  
   - _open, close_ - открытие и закрытие модального окна.

2. #### **Класс Form extends Component**      
   Универсальный класс для работы с формами.  
   Принимает в конструкторе селектор конкретной формы.  
   __Методы класса__:
   - _onInputChange_ // отслеживает изменения в форме  
   - _set valid_ // активация/деактивация кнопки формы
   - _set errors_ // установка текста ошибки валидации  

3. #### **Класс PageUI extends Component implements IPage**      
   Выводит в контейнере галерею товаров, работает со счетчиком корзины в хэдере и отвечает за блокировку экрана при вызове модального окна.  
   __Методы класса__:
   - _set catalog(ICatalogItem[])_ // отрисовка карточек товара.
   - _set counter(number)_ //установка цифры в счетчике товаров на иконке корзины.
   - _set locked(boolean)_ // блокировка скролла

4. #### **Класс CardUI extends Component implements IProductCard.**    
  Класс для отображения карточки товара.

6. #### **Класс CatalogItemUI extends CardUI implements ICatalogItem.**     
   Элемент галереи.  
   События: modal:open, modal:close, basket:changed-item  

7. #### **Класс PopupWithCartUI extends Modal, CardUI implements IProductCard.**      
   Отображает элементы товара в полном объеме + кнопку "Купить".
   Если цена null, то Кнопка "Купить" не активна.
   При клике на кнопку "Купить" генерируется событие basket:changed-item, Текст кнопки меняется на "Удалить из корзины" и обновляется цифра на иконке корзины.
   При клике на кнопку "Удалить из корзины" генерируется событие basket:changed-item, Текст кнопки меняется на "Купить" и обновляется цифра на иконке корзины.

8. #### **Класс PopupBasketUI extends Modal implements IBasket.**     
   Отображает элементы корзины: список товаров(название и цена), иконка удаления корзины у каждого товара, кнопка Оформить и итоговая цена заказа.  
   Если товаров в корзине нет, то отображается текст "Вы еще не добавили ни одного товара", кнопка Оформить не активна, общая цена 0.
   При клике на иконку удаления корзины генерируется событие basket:changed-item,, товар удаляется из корзины и обновляется цифра на иконке корзины.  
   При клике на кнопку "Оформить" генерируется событие basket:create-order, модальное окно закрывается и открывается первое окно оформления товара.

9. #### **Класс PopupOrderDeliveryUI extends Modal, Form implements IOrderDelivery.**      
   Отображает элементы формы выбора способа оплаты и адрес.
   Содержит кнопку Далее(изначально не активна).
   Когда все обязательные поля формы заполнены и прошли валидацию, то кнопки становятся активными.
   При нажатии на кнопку "Далее" генерируется событие order:valid-check, закрывается текущее модальное окно и открывается следующий шаг.
   

10. #### **Класс PopupOrderContactsUI extends Modal, Form implements IOrderContacts.**      
   Отображает элементы формы ввода телефона и email.
   Содержит кнопку Оформить(изначально не активна).
   Когда все обязательные поля формы заполнены и прошли валидацию, то кнопки становятся активными order:valid-check.
   При нажатии на кнопку "Оформить" генерируется событие order:submit, оркно закрывается, корзина очищается. 

10. #### **Класс PopupOrderStatusUI extends Modal implements IOrderStatus.**     
   Наследуется от класса Modal.
   Отображает информацию со статусом заказа, номером и списанной суммы.
   __Методы класса__:
   - _set totalPrice()_ // установить списанную сумму за заказ

### Описание событий

**cards:changed**  
Событие возникает при изменении списка товаров.  
Действия:

- отрисовать/перерисовать товары на страницы

**modal:open**  
Событие возникает при открытиии модального окна  
Действия:

- открыть модальное окно
- заблокирвоать прокрутку страницы

**modal:close**  
Событие возникает при закрытии модального окна  
Действия:

- закрыть модальное окно
- разблокирвоать прокрутку страницы

**basket:changed-item**  
Событие возникает при добавлении или удалении товара из корзины  
Действия:

- обновить список товаров в корзине
- перерисовать список товаров в корзине
- обновить цифру на иконке корзины на главной странице
- обновить итоговую сумму заказа

**basket:create-order**  
Событие возникает при клике на кнопку "Оформить" в корзине  
Действия:

- закрыть модальное окно корзины (**modal:close** )
- открыть модальное окно оформления товаров(**modal:open**)

**order:valid-check**  
Событие возникает при изменении полей формы  
Действия:

- записать введенные данные
- проверить валидацимю полей validateOrder()
- заблокировать/разблокировать кнопку, показать\скрыть сообщения об ошибке

**order:submit**  
Событие возникает при клике на кнопку Оплатить  
Действия:

- отправить заказ на сервер(POST)
- закрыть модальное окно заказа (**modal:close** )
- очистить корзину
- обнулисть цифру на иконке корзины
- открыть модальное окно успешного оформления заказа (**modal:open**)
- отрисовать сумму списанных синапсов в новом модальном окне

***
cпасибо!