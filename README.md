# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура
В проекте используется шаблон проектирования MVP.
Так как наше приложение небольшое, представление(Presenter) будет реализован в index.ts
![схема uml](https://private-user-images.githubusercontent.com/65623244/307611158-fbb979e4-252e-4238-8791-ab9474d0ccec.jpg?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDg4ODM0MTUsIm5iZiI6MTcwODg4MzExNSwicGF0aCI6Ii82NTYyMzI0NC8zMDc2MTExNTgtZmJiOTc5ZTQtMjUyZS00MjM4LTg3OTEtYWI5NDc0ZDBjY2VjLmpwZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAyMjUlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMjI1VDE3NDUxNVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTNiNWU2NTBkNWE5NjIyMTcyNjMzYzg2M2JhMDM5YmNjMzc4ODE0MjRiMjllOGUyMzVhNzUzNzgzMjIzZjZjNDgmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.W--gEqIo5EOGt_bPjC-NV3pcpW4l62kAkz0V6lEviLs)


### Описание данных
* Интерфейс состояния приложения
~~~
interface IAppState {
  catalog: {
    total: number;
    items: IProductCard[];
  };
  preview: IProductCard;
  order: IOrder;
  loading: boolean;
}
~~~

* Интрефейс карточки товара
~~~
export interface IProductCard {
  id: string;
  title: string;
  description: string;
  image: string;
  category: string;
  price: number | null;
};
~~~

* Тип карточки товара для галереи на главнйо страницы
~~~
export type ICatalogItem = Omit<IProductCard, 'description'>;
~~~

* Тип корзины
~~~
export type IBasket= {
  item: Pick<IProductCard, 'id' | 'title' | 'price'>[]
  total: number
};
~~~

* Тип способа оплаты
~~~
export type IPaymenOption  = 'cash' | 'card';
~~~

* Интрефейс данных заказа
~~~
export interface IOrder {
  payment: IPaymenOption;
  address: string;
  phone: string;
  email: string;  
  total: number;
  items: string[];
};
~~~

Интерфейс главнйо старницы
~~~
export interface IPage {
  counterBasket: number;
  catalog: ICatalogItem[];
  locked: boolean;
};
~~~

#### Базовые классы

1. **Класс Component**  
   Абстрактный базовый класс для компонентов, который содержит инструментарий для работы с DOM в дочерних компонентах.
   Аргументом конструктора служит HTMLElement.  
   Методы класса:
   - _toggleClass_ - переключение класса;
   - _setText_ - установка текстового содержимого;
   - _show, hide_ - скрыть/показать элемент.

2. **Класс Model**  
   Базовая модель, чтобы можно было отличить ее от простых объектов с данными.

### Слой Модели данных
1. **Класс AppState**  
Класс описывает состояние приложения, реализует интерфейс IAppState.  
Методы класса:
   - _setCatalog(IProductCard[]): void_ // метод, который записывает список товаров, пришедших с сервера в  AppState.catalog
   - _setPreview(id): void_ // метод, который записывает id карточки для отображения попапа с полной ифнормацией о товаре
   - _getTotalPrice(): void_ // метод, расчитывает общую стоимость заказа
   - _countBasketItem(): number_ //метод, расчитывает количество товарво в корзины
   - _setOrderItem(id, string)_ // метод записывает id товара в AppState.catalog.order.items
   - _setOrderField(keyof IOrder_, string |string[] ): void  // метод записывает значения полей формы в AppState.catalog.order
   - _validateOrder(): boolean _// метод  проверки валидации полей
   - _clearBasket(): void_ // метод очистки корзины

### Слой Presenter

1. **Класс Api**  
   Класc для работы с api.  
   Методы класса:
   - _handleResponse_ // обработка ответа с сервера;
   - _get_ // выполнение GET запроса;
   - _post_ // выполнение POST запроса;

2. **Класс EventEmitter**  
   Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.  
   Методы класса:

   - _on , off , emit_ // для подписки на событие, отписки от события и уведомления подписчиков о наступлении события соответственно.
   - _onAll и offAll_ // для подписки на все события и сброса всех подписчиков.
   - _trigger_ // генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter .

### Слой View - Компоненты представления

1. **Класс Modal**  
   Универсальный класс для работы с модальными окнами.
   Конструктор принимает в качестве аргумента селектор интересующего нас модального окна.   
   Методы класса:  
   - _open, close_ - открытие и закрытие модального окна.

2. **Класс Form**  
   Универсальный класс для работы с формами.
   Принимает в конструкторе селектор конкретной формы.  
   Методы класса:
   - _onInputChange_ // отслеживает изменения в форме

3. **Класс PageUI**  
   Выводит в контейнере галерею товаров, работает со счетчиком корзины в хэдере и отвечает за блокипровку эжкрана при вызове модального окна.
   Методы класса:
   - _set catalog(ICatalogItem[])_ // отрисовка карточек товара.
   - _set counter(number)_ //установка цифры в счетчике товаров на иконке корзины.
   - _set locked(boolean)_ // блокировка скролла

4. **Класс CardUI**
  Класс для отображения карточки товара.
  Зависит от переданных данных, может менять отображение. 

6. **Класс CatalogItemUI**  
   Элемент галереи (класс Catalog).
   Содержит элементы товара интерфейса ICatalogItem
   События: modal:open, modal:close, basket:changed-item

7. **Класс PopupWithCartUI**   
   Отображает элементы товара в полном объеме( интерфейс IProductCard) + кнопку "Купить".
   Если цена null, то Кнопка "Купить" не активна.
   При клике на кнопку "Купить" генерируется событие basket:changed-item, Текст кнопки меняется на "Удалить из корзины" и обновляется цифра на иконке корзины.
   При клике на кнопку "Удалить из корзины" генерируется событие basket:changed-item, Текст кнопки меняется на "Купить" и обновляется цифра на иконке корзины.

8. **Класс PopupOrderUI**  
   Отображает элементы корзины: список товаров(название и цена), иконка удаления корзины у каждого товара, кнопка Оформить и итоговая цена заказа.
   Если товаров в корзине нет, то отображается текст "Вы еще не добавили ни одного товара", кнопка Оформить не активна, общая цена 0.
   При клике на иконку удаления корзины генерируется событие basket:changed-item,, товар удаляется из корзины и обновляется цифра на иконке корзины.
   При клике на кнопку "Оформить" генерируется событие basket:create-order, модальное окно закрывается и открывается первое окно оформления товара.

9. **Класс PopupOrderDeliveryUI**  
   Отображает элементы формы выбора способа оплаты и адрес.
   Содержит кнопку Далее(изначально не активна).
   Когда все обязательные поля формы заполнены и прошли валидацию, то кнопки становятся активными.
   При нажатии на кнопку "Далее" генерируется событие order:valid-check, закрывается текущее модальное окно и открывается следующий шаг.
   

10. **Класс PopupOrderContactsUI**  
   Отображает элементы формы ввода телефона и email.
   Содержит кнопку Оформить(изначально не активна).
   Когда все обязательные поля формы заполнены и прошли валидацию, то кнопки становятся активными order:valid-check.
   При нажатии на кнопку "Оформить" генерируется событие order:submit, оркно закрывается, корзина очищается. 

10. **Класс PopupOrderStatusUI**  
    Отображает информацию со статусом заказа, номером и списанной суммы

## Описание событий

**cards:changed**  
Событие возникает при изменении списка товаров.  
Действия:

- отрисовать/перерисовать товары на страницы

**modal:open**  
Событие возникает при открытиии модального окна  
Действия:

- открыть модальное окно
- заблокирвоать прокрутку страницы

**modal:close**  
Событие возникает при закрытии модального окна  
Действия:

- закрыть модальное окно
- разблокирвоать прокрутку страницы

**basket:changed-item**  
Событие возникает при добавлении или удалении товара из корзины  
Действия:

- обновить список товаров в корзине
- перерисовать список товаров в корзине
- обновить цифру на иконке корзины на главной странице
- обновить итоговую сумму заказа

**basket:create-order**  
Событие возникает при клике на кнопку "Оформить" в корзине  
Действия:

- закрыть модальное окно корзины (**modal:close** )
- открыть модальное окно оформления товаров(**modal:open**)

**order:valid-check**  
Событие возникает при изменении полей формы  
Действия:

- записать введенные данные
- проверить валидацимю полей validateOrder()
- заблокировать/разблокировать кнопку, показать\скрыть сообщения об ошибке

**order:submit**  
Событие возникает при клике на кнопку Оплатить  
Действия:

- отправить заказ на сервер(POST)
- закрыть модальное окно заказа (**modal:close** )
- очистить корзину
- обнулисть цифру на иконке корзины
- открыть модальное окно успешного оформления заказа (**modal:open**)
- отрисовать сумму списанных синапсов в новом модальном окне
